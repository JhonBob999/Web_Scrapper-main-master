import os
import json
import importlib.util

EXPLOITS_DIR = "Exploits"

def load_all_exploits():
    exploits = []
    for folder in os.listdir(EXPLOITS_DIR):
        folder_path = os.path.join(EXPLOITS_DIR, folder)
        if os.path.isdir(folder_path):
            metadata_path = os.path.join(folder_path, "metadata.json")
            if os.path.exists(metadata_path):
                with open(metadata_path, "r", encoding="utf-8") as f:
                    try:
                        data = json.load(f)
                        data["folder"] = folder  # добавим имя папки
                        exploits.append(data)
                    except json.JSONDecodeError:
                        print(f"[EXPLOIT] Invalid JSON in {metadata_path}")
    return exploits

def import_exploit_function(folder, script_name, func_name):
    path = os.path.join("Exploits", folder, script_name)
    if not os.path.exists(path):
        print(f"[IMPORT] File not found: {path}")
        return None
    spec = importlib.util.spec_from_file_location("module.name", path)
    module = importlib.util.module_from_spec(spec)
    spec.loader.exec_module(module)
    return getattr(module, func_name, None)
