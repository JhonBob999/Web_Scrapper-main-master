import json
import os
from datetime import datetime

LOG_DIR = "data/exploit_logs"

def log_exploit_result(exploit_id, target, status, output):
    if not os.path.exists(LOG_DIR):
        os.makedirs(LOG_DIR)

    today = datetime.now().strftime("%Y-%m-%d")
    log_path = os.path.join(LOG_DIR, f"{today}.json")

    entry = {
        "timestamp": datetime.now().isoformat(timespec="seconds"),
        "exploit_id": exploit_id,
        "target": target,
        "status": status,
        "output": output
    }

    logs = []
    if os.path.exists(log_path):
        with open(log_path, "r", encoding="utf-8") as f:
            try:
                logs = json.load(f)
            except:
                logs = []

    logs.append(entry)

    with open(log_path, "w", encoding="utf-8") as f:
        json.dump(logs, f, indent=2)
